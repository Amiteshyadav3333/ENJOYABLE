<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Interactive Podcast Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: white; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .podcast-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .podcast-card { background: #2d2d2d; padding: 20px; border-radius: 10px; cursor: pointer; transition: transform 0.2s; }
        .podcast-card:hover { transform: translateY(-5px); }
        .live-badge { background: #ff4444; padding: 5px 10px; border-radius: 15px; font-size: 12px; margin-bottom: 10px; display: inline-block; }
        .chat-container { background: #2d2d2d; border-radius: 10px; padding: 20px; height: 400px; display: flex; flex-direction: column; }
        .chat-messages { flex: 1; overflow-y: auto; margin-bottom: 15px; }
        .chat-input { display: flex; gap: 10px; }
        .chat-input input { flex: 1; padding: 10px; border: none; border-radius: 5px; background: #3d3d3d; color: white; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .reactions { display: flex; gap: 10px; margin: 15px 0; }
        .reaction-btn { background: none; border: 2px solid #555; border-radius: 25px; padding: 8px 15px; color: white; cursor: pointer; }
        .reaction-btn:hover { border-color: #007bff; }
        .participant-count { background: #007bff; padding: 5px 10px; border-radius: 15px; font-size: 14px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéôÔ∏è Live Interactive Podcast Platform</h1>
            <p>Join thousands of listeners in real-time interactive podcasts</p>
        </div>

        <div id="loginSection">
            <div style="max-width: 400px; margin: 0 auto; background: #2d2d2d; padding: 30px; border-radius: 10px;">
                <h2>Join the Platform</h2>
                <input type="text" id="username" placeholder="Username" style="width: 100%; padding: 10px; margin: 10px 0; border: none; border-radius: 5px; background: #3d3d3d; color: white;">
                <input type="password" id="password" placeholder="Password" style="width: 100%; padding: 10px; margin: 10px 0; border: none; border-radius: 5px; background: #3d3d3d; color: white;">
                <button onclick="login()" class="btn btn-primary" style="width: 100%; margin: 10px 0;">Login</button>
                <button onclick="register()" class="btn btn-success" style="width: 100%;">Register</button>
            </div>
        </div>

        <div id="mainSection" class="hidden">
            <div id="podcastsSection">
                <h2>üî¥ Live Podcasts</h2>
                <div id="podcastGrid" class="podcast-grid"></div>
                <button onclick="showCreatePodcast()" class="btn btn-success">Create New Podcast</button>
            </div>

            <div id="createPodcastSection" class="hidden">
                <div style="max-width: 500px; margin: 0 auto; background: #2d2d2d; padding: 30px; border-radius: 10px;">
                    <h2>Create New Podcast</h2>
                    <input type="text" id="podcastTitle" placeholder="Podcast Title" style="width: 100%; padding: 10px; margin: 10px 0; border: none; border-radius: 5px; background: #3d3d3d; color: white;">
                    <textarea id="podcastDescription" placeholder="Description" style="width: 100%; padding: 10px; margin: 10px 0; border: none; border-radius: 5px; background: #3d3d3d; color: white; height: 100px;"></textarea>
                    <button onclick="createPodcast()" class="btn btn-primary" style="width: 100%; margin: 10px 0;">Create & Go Live</button>
                    <button onclick="showPodcasts()" class="btn" style="width: 100%; background: #555; color: white;">Cancel</button>
                </div>
            </div>

            <div id="liveSection" class="hidden">
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <div>
                        <div style="background: #2d2d2d; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h2 id="livePodcastTitle">Podcast Title</h2>
                            <div style="display: flex; gap: 15px; align-items: center; margin: 15px 0;">
                                <span class="live-badge">üî¥ LIVE</span>
                                <span id="participantCount" class="participant-count">0 listeners</span>
                            </div>
                            <div style="margin: 20px 0;">
                                <button onclick="leavePodcast()" class="btn btn-danger">Leave</button>
                            </div>
                        </div>
                        <div class="reactions">
                            <button onclick="sendReaction('üëè')" class="reaction-btn">üëè</button>
                            <button onclick="sendReaction('‚ù§Ô∏è')" class="reaction-btn">‚ù§Ô∏è</button>
                            <button onclick="sendReaction('üòÇ')" class="reaction-btn">üòÇ</button>
                            <button onclick="sendReaction('üî•')" class="reaction-btn">üî•</button>
                        </div>
                    </div>
                    <div class="chat-container">
                        <h3>Live Chat</h3>
                        <div id="chatMessages" class="chat-messages"></div>
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Type message..." onkeypress="handleChatKeypress(event)">
                            <button onclick="sendChat()" class="btn btn-primary">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let socket;
        let currentUser = null;
        let currentRoom = null;

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.user) {
                    currentUser = data.user;
                    initializeSocket();
                    showMainSection();
                    loadPodcasts();
                } else {
                    alert(data.error || 'Login failed');
                }
            });
        }

        function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            fetch('/api/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password, is_creator: true })
            })
            .then(res => res.json())
            .then(data => {
                if (data.user_id) {
                    alert('Registration successful! Please login.');
                } else {
                    alert(data.error || 'Registration failed');
                }
            });
        }

        function initializeSocket() {
            socket = io();
            
            socket.on('joined_podcast', (data) => {
                currentRoom = data.room_id;
                document.getElementById('participantCount').textContent = `${data.participant_count} listeners`;
            });

            socket.on('chat_message', (data) => {
                addChatMessage(data.username, data.message);
            });

            socket.on('reaction', (data) => {
                showReaction(data.reaction);
            });

            socket.on('user_joined', (data) => {
                document.getElementById('participantCount').textContent = `${data.participant_count} listeners`;
            });
        }

        function showMainSection() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainSection').classList.remove('hidden');
        }

        function loadPodcasts() {
            fetch('/api/podcasts')
            .then(res => res.json())
            .then(podcasts => {
                const grid = document.getElementById('podcastGrid');
                grid.innerHTML = podcasts.map(p => `
                    <div class="podcast-card" onclick="joinPodcast('${p.room_id}', '${p.title}')">
                        <div class="live-badge">üî¥ LIVE</div>
                        <h3>${p.title}</h3>
                        <p>${p.description}</p>
                    </div>
                `).join('');
            });
        }

        function showCreatePodcast() {
            document.getElementById('podcastsSection').classList.add('hidden');
            document.getElementById('createPodcastSection').classList.remove('hidden');
        }

        function showPodcasts() {
            document.getElementById('createPodcastSection').classList.add('hidden');
            document.getElementById('podcastsSection').classList.remove('hidden');
        }

        function createPodcast() {
            const title = document.getElementById('podcastTitle').value;
            const description = document.getElementById('podcastDescription').value;
            
            fetch('/api/podcasts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, description })
            })
            .then(res => res.json())
            .then(data => {
                if (data.room_id) {
                    fetch(`/api/podcasts/${data.podcast_id}/start`, { method: 'POST' })
                    .then(() => joinPodcast(data.room_id, title));
                }
            });
        }

        function joinPodcast(roomId, title) {
            currentRoom = roomId;
            document.getElementById('livePodcastTitle').textContent = title;
            
            socket.emit('join_podcast', {
                room_id: roomId,
                username: currentUser.username
            });
            
            document.getElementById('podcastsSection').classList.add('hidden');
            document.getElementById('liveSection').classList.remove('hidden');
        }

        function sendChat() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (message && currentRoom) {
                socket.emit('send_chat', { room_id: currentRoom, message });
                input.value = '';
            }
        }

        function handleChatKeypress(event) {
            if (event.key === 'Enter') sendChat();
        }

        function sendReaction(emoji) {
            if (currentRoom) {
                socket.emit('send_reaction', { room_id: currentRoom, reaction: emoji });
            }
        }

        function leavePodcast() {
            document.getElementById('liveSection').classList.add('hidden');
            document.getElementById('podcastsSection').classList.remove('hidden');
            currentRoom = null;
        }

        function addChatMessage(username, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.innerHTML = `<strong>${username}:</strong> ${message}`;
            messageDiv.style.marginBottom = '10px';
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showReaction(reaction) {
            const reactionDiv = document.createElement('div');
            reactionDiv.textContent = reaction;
            reactionDiv.style.position = 'fixed';
            reactionDiv.style.fontSize = '24px';
            reactionDiv.style.zIndex = '1000';
            reactionDiv.style.left = Math.random() * window.innerWidth + 'px';
            reactionDiv.style.top = window.innerHeight + 'px';
            reactionDiv.style.transition = 'all 3s ease-out';
            document.body.appendChild(reactionDiv);
            
            setTimeout(() => {
                reactionDiv.style.top = '-50px';
                reactionDiv.style.opacity = '0';
            }, 100);
            
            setTimeout(() => document.body.removeChild(reactionDiv), 3000);
        }
    </script>
</body>
</html>