<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoTube - Live Video Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', Arial, sans-serif; background: #0f0f0f; color: #fff; }
        
        /* Header */
        .header { background: #212121; padding: 0 16px; height: 56px; display: flex; align-items: center; justify-content: space-between; position: fixed; top: 0; width: 100%; z-index: 1000; }
        .logo { font-size: 20px; font-weight: bold; color: #ff0000; }
        .search-bar { flex: 1; max-width: 640px; margin: 0 40px; }
        .search-bar input { width: 100%; padding: 12px 16px; border: 1px solid #303030; background: #121212; color: #fff; border-radius: 2px 0 0 2px; }
        .search-btn { padding: 12px 20px; background: #303030; border: 1px solid #303030; color: #fff; border-radius: 0 2px 2px 0; cursor: pointer; }
        .user-menu { display: flex; align-items: center; gap: 16px; }
        .upload-btn { background: #065fd4; color: white; padding: 8px 16px; border: none; border-radius: 18px; cursor: pointer; }
        
        /* Main Content */
        .main-content { margin-top: 56px; display: flex; }
        .sidebar { width: 240px; background: #212121; height: calc(100vh - 56px); padding: 12px 0; position: fixed; }
        .sidebar-item { padding: 10px 24px; cursor: pointer; display: flex; align-items: center; gap: 24px; }
        .sidebar-item:hover { background: #3d3d3d; }
        .content { margin-left: 240px; padding: 24px; flex: 1; }
        
        /* Video Grid */
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }
        .video-card { background: #212121; border-radius: 12px; overflow: hidden; cursor: pointer; transition: transform 0.2s; }
        .video-card:hover { transform: scale(1.02); }
        .video-thumbnail { width: 100%; height: 180px; background: #000; position: relative; }
        .video-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
        .video-duration { position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); padding: 2px 4px; border-radius: 2px; font-size: 12px; }
        .live-badge { position: absolute; top: 8px; left: 8px; background: #ff0000; padding: 2px 8px; border-radius: 2px; font-size: 12px; font-weight: bold; }
        .video-info { padding: 12px; }
        .video-title { font-size: 14px; font-weight: 500; margin-bottom: 4px; line-height: 1.3; }
        .video-meta { font-size: 13px; color: #aaa; }
        .video-stats { display: flex; gap: 8px; margin-top: 4px; }
        
        /* Video Player */
        .video-player-container { max-width: 1280px; margin: 0 auto; }
        .video-player { width: 100%; height: 720px; background: #000; border-radius: 12px; overflow: hidden; }
        .video-player video { width: 100%; height: 100%; }
        .video-details { margin-top: 20px; }
        .video-title-large { font-size: 20px; font-weight: 400; margin-bottom: 8px; }
        .video-actions { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid #3d3d3d; }
        .video-stats-large { display: flex; gap: 16px; color: #aaa; }
        .action-buttons { display: flex; gap: 8px; }
        .action-btn { background: #3d3d3d; border: none; color: #fff; padding: 8px 16px; border-radius: 18px; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .action-btn:hover { background: #4d4d4d; }
        .action-btn.liked { background: #065fd4; }
        
        /* Comments */
        .comments-section { margin-top: 24px; }
        .comments-header { font-size: 16px; margin-bottom: 24px; }
        .comment-form { display: flex; gap: 12px; margin-bottom: 24px; }
        .comment-input { flex: 1; background: transparent; border: none; border-bottom: 1px solid #3d3d3d; color: #fff; padding: 8px 0; }
        .comment-btn { background: #065fd4; color: white; border: none; padding: 8px 16px; border-radius: 18px; cursor: pointer; }
        .comment { display: flex; gap: 12px; margin-bottom: 16px; }
        .comment-avatar { width: 40px; height: 40px; border-radius: 50%; background: #3d3d3d; }
        .comment-content { flex: 1; }
        .comment-author { font-size: 13px; font-weight: 500; margin-bottom: 2px; }
        .comment-text { font-size: 14px; line-height: 1.4; }
        .comment-actions { margin-top: 8px; display: flex; gap: 16px; }
        .comment-action { background: none; border: none; color: #aaa; cursor: pointer; font-size: 12px; }
        
        /* Upload Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; }
        .modal-content { background: #212121; margin: 5% auto; padding: 24px; width: 90%; max-width: 600px; border-radius: 12px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .close-btn { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 14px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #fff; border-radius: 4px; }
        .form-group textarea { height: 100px; resize: vertical; }
        
        /* Login */
        .login-container { max-width: 400px; margin: 100px auto; background: #212121; padding: 32px; border-radius: 12px; }
        .login-title { text-align: center; margin-bottom: 24px; font-size: 24px; }
        .login-form input { width: 100%; padding: 12px; margin-bottom: 16px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #fff; border-radius: 4px; }
        .login-btn { width: 100%; padding: 12px; background: #065fd4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        
        .hidden { display: none; }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">üì∫ VideoTube</div>
        <div class="search-bar">
            <input type="text" placeholder="Search videos..." id="searchInput">
            <button class="search-btn">üîç</button>
        </div>
        <div class="user-menu">
            <button class="upload-btn" onclick="showUploadModal()">+ Upload</button>
            <span id="userDisplay">Guest</span>
            <button onclick="logout()" id="logoutBtn" class="hidden">Logout</button>
        </div>
    </div>

    <!-- Login -->
    <div id="loginContainer" class="login-container">
        <h2 class="login-title">Login to VideoTube</h2>
        <div class="login-form">
            <input type="text" id="loginUsername" placeholder="Username">
            <input type="password" id="loginPassword" placeholder="Password">
            <button class="login-btn" onclick="login()">Login</button>
            <p style="text-align: center; margin-top: 16px; color: #aaa;">
                Demo: admin/admin123 or creator1/pass123
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content hidden" id="mainContent">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-item" onclick="showHome()">üè† Home</div>
            <div class="sidebar-item" onclick="showTrending()">üî• Trending</div>
            <div class="sidebar-item" onclick="showLive()">üî¥ Live</div>
            <div class="sidebar-item" onclick="showMyVideos()">üìπ My Videos</div>
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- Video Grid -->
            <div id="videoGrid" class="video-grid"></div>

            <!-- Video Player -->
            <div id="videoPlayer" class="video-player-container hidden">
                <div class="video-player">
                    <video id="mainVideo" controls>
                        <source src="" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                
                <div class="video-details">
                    <h1 id="videoTitle" class="video-title-large"></h1>
                    <div class="video-actions">
                        <div class="video-stats-large">
                            <span id="videoViews">0 views</span>
                            <span id="videoDate">Today</span>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="likeVideo()">üëç <span id="likeCount">0</span></button>
                            <button class="action-btn" onclick="dislikeVideo()">üëé <span id="dislikeCount">0</span></button>
                            <button class="action-btn" onclick="shareVideo()">üì§ Share</button>
                            <button class="action-btn" onclick="downloadVideo()">‚¨áÔ∏è Download</button>
                            <button class="action-btn" id="deleteBtn" onclick="deleteVideo()" style="display: none;">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                    
                    <div class="video-description" id="videoDescription"></div>
                    
                    <!-- Comments -->
                    <div class="comments-section">
                        <div class="comments-header"><span id="commentCount">0</span> Comments</div>
                        <div class="comment-form">
                            <input type="text" class="comment-input" id="commentInput" placeholder="Add a comment...">
                            <button class="comment-btn" onclick="addComment()">Comment</button>
                        </div>
                        <div id="commentsList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Upload Video</h2>
                <button class="close-btn" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="uploadTitle" placeholder="Enter video title">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="uploadDescription" placeholder="Enter video description"></textarea>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="isLive"> Live Stream
                </label>
            </div>
            <button class="login-btn" onclick="uploadVideo()">Upload Video</button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentVideo = null;
        let videos = [];

        // Authentication
        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.user) {
                    currentUser = data.user;
                    document.getElementById('userDisplay').textContent = data.user.username;
                    document.getElementById('loginContainer').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    document.getElementById('logoutBtn').classList.remove('hidden');
                    loadVideos();
                } else {
                    alert(data.error);
                }
            });
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('logoutBtn').classList.add('hidden');
        }

        // Video Management
        function loadVideos() {
            fetch('/api/videos')
            .then(res => res.json())
            .then(data => {
                videos = data;
                displayVideos(videos);
            });
        }

        function displayVideos(videoList) {
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = videoList.map(video => `
                <div class="video-card" onclick="playVideo('${video.id}')">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDMyMCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMjAiIGhlaWdodD0iMTgwIiBmaWxsPSIjMzMzIi8+Cjx0ZXh0IHg9IjE2MCIgeT0iOTAiIGZpbGw9IiM2NjYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5WaWRlbyBUaHVtYm5haWw8L3RleHQ+Cjwvc3ZnPg=='">
                        ${video.is_live ? '<div class="live-badge">üî¥ LIVE</div>' : ''}
                        <div class="video-duration">${video.duration}</div>
                    </div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-meta">${video.creator_name}</div>
                        <div class="video-stats">
                            <span>${video.views} views</span>
                            <span>üëç ${video.likes}</span>
                            <span>üí¨ ${video.comments_count}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function playVideo(videoId) {
            fetch(`/api/videos/${videoId}`)
            .then(res => res.json())
            .then(video => {
                currentVideo = video;
                document.getElementById('videoGrid').classList.add('hidden');
                document.getElementById('videoPlayer').classList.remove('hidden');
                
                document.getElementById('mainVideo').src = video.video_url;
                document.getElementById('videoTitle').textContent = video.title;
                document.getElementById('videoViews').textContent = `${video.views} views`;
                document.getElementById('videoDescription').textContent = video.description;
                document.getElementById('likeCount').textContent = video.likes;
                document.getElementById('dislikeCount').textContent = video.dislikes;
                document.getElementById('commentCount').textContent = video.comments.length;
                
                // Show delete button if user owns video or is admin
                if (currentUser && (currentUser.id === video.creator_id || currentUser.id === 'admin')) {
                    document.getElementById('deleteBtn').style.display = 'block';
                }
                
                displayComments(video.comments);
            });
        }

        function displayComments(comments) {
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = comments.map(comment => `
                <div class="comment">
                    <div class="comment-avatar"></div>
                    <div class="comment-content">
                        <div class="comment-author">${comment.username}</div>
                        <div class="comment-text">${comment.text}</div>
                        <div class="comment-actions">
                            <button class="comment-action">üëç</button>
                            <button class="comment-action">üëé</button>
                            ${currentUser && (currentUser.id === comment.user_id || currentUser.id === 'admin') ? 
                                `<button class="comment-action" onclick="deleteComment('${comment.id}')">Delete</button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function likeVideo() {
            if (!currentUser || !currentVideo) return;
            
            fetch(`/api/videos/${currentVideo.id}/like`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: currentUser.id, type: 'like' })
            })
            .then(() => playVideo(currentVideo.id));
        }

        function dislikeVideo() {
            if (!currentUser || !currentVideo) return;
            
            fetch(`/api/videos/${currentVideo.id}/like`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: currentUser.id, type: 'dislike' })
            })
            .then(() => playVideo(currentVideo.id));
        }

        function addComment() {
            if (!currentUser || !currentVideo) return;
            
            const text = document.getElementById('commentInput').value.trim();
            if (!text) return;
            
            fetch(`/api/videos/${currentVideo.id}/comments`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: currentUser.id,
                    username: currentUser.username,
                    text: text
                })
            })
            .then(() => {
                document.getElementById('commentInput').value = '';
                playVideo(currentVideo.id);
            });
        }

        function deleteComment(commentId) {
            if (!currentUser || !currentVideo) return;
            
            fetch(`/api/videos/${currentVideo.id}/comments/${commentId}`, {
                method: 'DELETE'
            })
            .then(() => playVideo(currentVideo.id));
        }

        function deleteVideo() {
            if (!currentUser || !currentVideo) return;
            
            if (confirm('Are you sure you want to delete this video?')) {
                fetch(`/api/videos/${currentVideo.id}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUser.id })
                })
                .then(() => {
                    showHome();
                    loadVideos();
                });
            }
        }

        function shareVideo() {
            if (navigator.share) {
                navigator.share({
                    title: currentVideo.title,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert('Video link copied to clipboard!');
            }
        }

        function downloadVideo() {
            if (!currentVideo) return;
            window.open(`/api/videos/${currentVideo.id}/download`, '_blank');
        }

        // Upload
        function showUploadModal() {
            document.getElementById('uploadModal').style.display = 'block';
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
        }

        function uploadVideo() {
            if (!currentUser) return;
            
            const title = document.getElementById('uploadTitle').value;
            const description = document.getElementById('uploadDescription').value;
            const isLive = document.getElementById('isLive').checked;
            
            fetch('/api/videos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    title: title,
                    description: description,
                    creator_id: currentUser.id,
                    creator_name: currentUser.username,
                    is_live: isLive
                })
            })
            .then(() => {
                closeUploadModal();
                loadVideos();
                alert('Video uploaded successfully!');
            });
        }

        // Navigation
        function showHome() {
            document.getElementById('videoPlayer').classList.add('hidden');
            document.getElementById('videoGrid').classList.remove('hidden');
            loadVideos();
        }

        function showTrending() {
            const trending = videos.sort((a, b) => b.views - a.views);
            displayVideos(trending);
        }

        function showLive() {
            const liveVideos = videos.filter(v => v.is_live);
            displayVideos(liveVideos);
        }

        function showMyVideos() {
            if (!currentUser) return;
            const myVideos = videos.filter(v => v.creator_id === currentUser.id);
            displayVideos(myVideos);
        }

        // Search
        document.getElementById('searchInput').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                const query = this.value.toLowerCase();
                const filtered = videos.filter(v => 
                    v.title.toLowerCase().includes(query) || 
                    v.description.toLowerCase().includes(query)
                );
                displayVideos(filtered);
            }
        });
    </script>
</body>
</html>