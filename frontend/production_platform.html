<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé• Production Video Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', Arial, sans-serif; background: #0f0f0f; color: #fff; }
        
        .header { background: #212121; padding: 0 16px; height: 56px; display: flex; align-items: center; justify-content: space-between; position: fixed; top: 0; width: 100%; z-index: 1000; }
        .logo { font-size: 20px; font-weight: bold; color: #ff0000; }
        .user-menu { display: flex; align-items: center; gap: 16px; }
        .upload-btn { background: #065fd4; color: white; padding: 8px 16px; border: none; border-radius: 18px; cursor: pointer; }
        .live-btn { background: #ff0000; color: white; padding: 8px 16px; border: none; border-radius: 18px; cursor: pointer; }
        
        .main-content { margin-top: 56px; padding: 24px; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }
        .video-card { background: #212121; border-radius: 12px; overflow: hidden; cursor: pointer; }
        .video-thumbnail { width: 100%; height: 180px; background: #000; position: relative; }
        .video-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
        .live-badge { position: absolute; top: 8px; left: 8px; background: #ff0000; padding: 2px 8px; border-radius: 2px; font-size: 12px; }
        .video-info { padding: 12px; }
        .video-title { font-size: 14px; font-weight: 500; margin-bottom: 4px; }
        .video-meta { font-size: 13px; color: #aaa; }
        
        .video-player { width: 100%; max-width: 1280px; margin: 0 auto; }
        .video-player video { width: 100%; height: 720px; background: #000; }
        .video-details { margin-top: 20px; }
        .video-actions { display: flex; gap: 8px; margin: 16px 0; }
        .action-btn { background: #3d3d3d; border: none; color: #fff; padding: 8px 16px; border-radius: 18px; cursor: pointer; }
        .action-btn:hover { background: #4d4d4d; }
        .action-btn.liked { background: #065fd4; }
        
        .comments-section { margin-top: 24px; }
        .comment-form { display: flex; gap: 12px; margin-bottom: 24px; }
        .comment-input { flex: 1; background: transparent; border: none; border-bottom: 1px solid #3d3d3d; color: #fff; padding: 8px 0; }
        .comment { display: flex; gap: 12px; margin-bottom: 16px; }
        .comment-content { flex: 1; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; }
        .modal-content { background: #212121; margin: 5% auto; padding: 24px; width: 90%; max-width: 600px; border-radius: 12px; }
        .form-group { margin-bottom: 16px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #fff; border-radius: 4px; }
        
        .login-container { max-width: 400px; margin: 100px auto; background: #212121; padding: 32px; border-radius: 12px; }
        .hidden { display: none; }
        
        .upload-progress { width: 100%; height: 4px; background: #3d3d3d; border-radius: 2px; margin: 10px 0; }
        .upload-progress-bar { height: 100%; background: #065fd4; border-radius: 2px; width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üé• VideoTube Pro</div>
        <div class="user-menu">
            <button class="upload-btn" onclick="showUploadModal()" id="uploadBtn" style="display: none;">üì§ Upload</button>
            <button class="live-btn" onclick="showLiveModal()" id="liveBtn" style="display: none;">üî¥ Go Live</button>
            <span id="userDisplay">Guest</span>
            <button onclick="logout()" id="logoutBtn" style="display: none;">Logout</button>
        </div>
    </div>

    <div id="loginContainer" class="login-container">
        <h2>Login to VideoTube Pro</h2>
        <input type="text" id="loginUsername" placeholder="Username" style="width: 100%; padding: 12px; margin: 8px 0; background: #3d3d3d; border: 1px solid #4d4d4d; color: #fff; border-radius: 4px;">
        <input type="password" id="loginPassword" placeholder="Password" style="width: 100%; padding: 12px; margin: 8px 0; background: #3d3d3d; border: 1px solid #4d4d4d; color: #fff; border-radius: 4px;">
        <button onclick="login()" style="width: 100%; padding: 12px; background: #065fd4; color: white; border: none; border-radius: 4px; cursor: pointer;">Login</button>
        <p style="text-align: center; margin-top: 16px; color: #aaa;">Demo: admin/admin123</p>
    </div>

    <div class="main-content hidden" id="mainContent">
        <div id="videoGrid" class="video-grid"></div>
        
        <div id="videoPlayer" class="video-player hidden">
            <video id="mainVideo" controls></video>
            <div class="video-details">
                <h1 id="videoTitle"></h1>
                <div class="video-actions">
                    <button class="action-btn" onclick="likeVideo()">üëç <span id="likeCount">0</span></button>
                    <button class="action-btn" onclick="dislikeVideo()">üëé <span id="dislikeCount">0</span></button>
                    <button class="action-btn" onclick="shareVideo()">üì§ Share</button>
                    <button class="action-btn" onclick="downloadVideo()">‚¨áÔ∏è Download</button>
                    <button class="action-btn" id="deleteBtn" onclick="deleteVideo()" style="display: none;">üóëÔ∏è Delete</button>
                </div>
                <div class="comments-section">
                    <div class="comment-form">
                        <input type="text" class="comment-input" id="commentInput" placeholder="Add a comment...">
                        <button onclick="addComment()" style="padding: 8px 16px; background: #065fd4; color: white; border: none; border-radius: 18px; cursor: pointer;">Comment</button>
                    </div>
                    <div id="commentsList"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <h2>Upload Video</h2>
            <div class="form-group">
                <input type="file" id="videoFile" accept="video/*" style="width: 100%; padding: 12px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #fff; border-radius: 4px;">
            </div>
            <div class="form-group">
                <input type="text" id="uploadTitle" placeholder="Video Title" style="width: 100%; padding: 12px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #fff; border-radius: 4px;">
            </div>
            <div class="form-group">
                <textarea id="uploadDescription" placeholder="Description" style="width: 100%; padding: 12px; background: #3d3d3d; border: 1px solid #4d4d4d; color: #fff; border-radius: 4px; height: 100px;"></textarea>
            </div>
            <div class="upload-progress">
                <div class="upload-progress-bar" id="uploadProgress"></div>
            </div>
            <button onclick="uploadVideo()" style="width: 100%; padding: 12px; background: #065fd4; color: white; border: none; border-radius: 4px; cursor: pointer;">Upload Video</button>
            <button onclick="closeUploadModal()" style="width: 100%; padding: 12px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 8px;">Cancel</button>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentVideo = null;
        let videos = [];

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.user) {
                    currentUser = data.user;
                    document.getElementById('userDisplay').textContent = data.user.username;
                    document.getElementById('loginContainer').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    document.getElementById('uploadBtn').style.display = 'block';
                    document.getElementById('liveBtn').style.display = 'block';
                    document.getElementById('logoutBtn').style.display = 'block';
                    loadVideos();
                } else {
                    alert(data.error);
                }
            });
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('uploadBtn').style.display = 'none';
            document.getElementById('liveBtn').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'none';
        }

        function loadVideos() {
            fetch('/api/videos')
            .then(res => res.json())
            .then(data => {
                videos = data;
                displayVideos(videos);
            });
        }

        function displayVideos(videoList) {
            const grid = document.getElementById('videoGrid');
            grid.innerHTML = videoList.map(video => `
                <div class="video-card" onclick="playVideo('${video.id}')">
                    <div class="video-thumbnail">
                        <img src="${video.thumbnail}" alt="${video.title}">
                        ${video.is_live ? '<div class="live-badge">üî¥ LIVE</div>' : ''}
                    </div>
                    <div class="video-info">
                        <div class="video-title">${video.title}</div>
                        <div class="video-meta">${video.creator_name} ‚Ä¢ ${video.views} views</div>
                    </div>
                </div>
            `).join('');
        }

        function playVideo(videoId) {
            fetch(`/api/videos/${videoId}`)
            .then(res => res.json())
            .then(video => {
                currentVideo = video;
                document.getElementById('videoGrid').classList.add('hidden');
                document.getElementById('videoPlayer').classList.remove('hidden');
                
                document.getElementById('mainVideo').src = video.video_url;
                document.getElementById('videoTitle').textContent = video.title;
                document.getElementById('likeCount').textContent = video.likes;
                document.getElementById('dislikeCount').textContent = video.dislikes;
                
                if (currentUser && (currentUser.id === video.creator_id || currentUser.id === 'admin')) {
                    document.getElementById('deleteBtn').style.display = 'block';
                }
                
                displayComments(video.comments);
            });
        }

        function displayComments(comments) {
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = comments.map(comment => `
                <div class="comment">
                    <div class="comment-content">
                        <strong>${comment.username}</strong>
                        <p>${comment.text}</p>
                    </div>
                </div>
            `).join('');
        }

        function likeVideo() {
            if (!currentUser || !currentVideo) return;
            
            fetch(`/api/videos/${currentVideo.id}/like`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: currentUser.id, type: 'like' })
            })
            .then(() => playVideo(currentVideo.id));
        }

        function dislikeVideo() {
            if (!currentUser || !currentVideo) return;
            
            fetch(`/api/videos/${currentVideo.id}/like`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_id: currentUser.id, type: 'dislike' })
            })
            .then(() => playVideo(currentVideo.id));
        }

        function addComment() {
            if (!currentUser || !currentVideo) return;
            
            const text = document.getElementById('commentInput').value.trim();
            if (!text) return;
            
            fetch(`/api/videos/${currentVideo.id}/comments`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    user_id: currentUser.id,
                    username: currentUser.username,
                    text: text
                })
            })
            .then(() => {
                document.getElementById('commentInput').value = '';
                playVideo(currentVideo.id);
            });
        }

        function shareVideo() {
            if (!currentVideo) return;
            
            fetch(`/api/videos/${currentVideo.id}/share`, {
                method: 'POST'
            })
            .then(res => res.json())
            .then(data => {
                navigator.clipboard.writeText(data.share_url);
                alert('Video link copied to clipboard!');
            });
        }

        function downloadVideo() {
            if (!currentVideo) return;
            window.open(`/api/videos/${currentVideo.id}/download`, '_blank');
        }

        function deleteVideo() {
            if (!currentUser || !currentVideo) return;
            
            if (confirm('Are you sure you want to delete this video?')) {
                fetch(`/api/videos/${currentVideo.id}`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUser.id })
                })
                .then(() => {
                    document.getElementById('videoPlayer').classList.add('hidden');
                    document.getElementById('videoGrid').classList.remove('hidden');
                    loadVideos();
                });
            }
        }

        function showUploadModal() {
            document.getElementById('uploadModal').style.display = 'block';
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
        }

        function uploadVideo() {
            if (!currentUser) return;
            
            const fileInput = document.getElementById('videoFile');
            const title = document.getElementById('uploadTitle').value;
            const description = document.getElementById('uploadDescription').value;
            
            if (!fileInput.files[0]) {
                alert('Please select a video file');
                return;
            }
            
            const formData = new FormData();
            formData.append('video', fileInput.files[0]);
            formData.append('title', title);
            formData.append('description', description);
            formData.append('creator_id', currentUser.id);
            formData.append('creator_name', currentUser.username);
            
            const xhr = new XMLHttpRequest();
            
            xhr.upload.addEventListener('progress', function(e) {
                if (e.lengthComputable) {
                    const percentComplete = (e.loaded / e.total) * 100;
                    document.getElementById('uploadProgress').style.width = percentComplete + '%';
                }
            });
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    closeUploadModal();
                    loadVideos();
                    alert('Video uploaded successfully!');
                } else {
                    alert('Upload failed');
                }
            };
            
            xhr.open('POST', '/api/upload-video');
            xhr.send(formData);
        }

        function showLiveModal() {
            alert('Live streaming feature coming soon!');
        }

        // Auto-refresh videos every 30 seconds
        setInterval(() => {
            if (currentUser && !document.getElementById('mainContent').classList.contains('hidden')) {
                loadVideos();
            }
        }, 30000);
    </script>
</body>
</html>